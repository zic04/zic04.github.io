---
layout: post
title: "Continuous Security with OWASP's Dependency Check Maven Plugin"
description: "Integrate OWASP dependency vulnerability checks into Java projects with Maven plugin"
category: articles
tags: [devops, documentation, github, java, maven, security, software, Spring]
comments: true
---

On the heels of the [previous post]({% post_url 2015-12-19-publish-maven-site-github-pages-travis-ci %}) about continuously delivering documentation I wanted to show how easy it is to integrate dependency vulnerability checks and reports into a Maven-based delivery pipeline. The [OWASP Top 10 2013](https://www.owasp.org/index.php/Category:OWASP_Top_Ten_Project) contains an entry about [Using Components with Known Vulnerabilities](https://www.owasp.org/index.php/Top_10_2013-A9-Using_Components_with_Known_Vulnerabilities), so being able to check project dependencies against a canonical list of vulnerable libraries is critical to compliance with the Top 10. The [OWASP Dependency Check](https://www.owasp.org/index.php/OWASP_Dependency_Check) utility uses NIST's [National Vulnerability Database](https://nvd.nist.gov/) (NVD) to identify the vulnerable dependencies, so the list is always up-to-date.

The Dependency Check utility is conveniently wrapped by the [dependency-check-maven](https://jeremylong.github.io/DependencyCheck/dependency-check-maven/) plugin. The usage information contains several examples and the configuration allows plenty of tuning for the analyzer. With a single configuration parameter the plugin can fail a build if a vulnerable dependency is found.

## CVSS Scores and the POM
The Common Vulnerability Scoring System (CVSS) uses several aspects of exploit-ability and impact to determine a _base score_. Each vulnerability in the NVD has a base score attached, and anything above 4.0 is considered Medium or High severity ([CVSS overview](https://nvd.nist.gov/cvss.cfm)).

Events following the publishing of a CVE can affect the CVSS score (e.g., an exploit kit is published). These adjusted scores are referred to as _temporal scores_, and CVSS provides [a calculator](https://nvd.nist.gov/cvss.cfm?calculator&version=2) to help understand the effect. The calculator is also quite handy to help understand what influences a score.

Thanks to [the examples](https://jeremylong.github.io/DependencyCheck/dependency-check-maven/index.html), configuring the POM is quite easy. Here's the configuration I'm using in my [`pom.xml`](https://github.com/lanyonm/playground/blob/7bebfc970608c102b3d6be5951b24f9ba95459a9/pom.xml#L201):

{% highlight xml %}
<project>
    <build>
        <plugins>
            <plugin>
                <groupId>org.owasp</groupId>
                <artifactId>dependency-check-maven</artifactId>
                <version>1.3.3</version>
                <configuration>
                    <cveValidForHours>12</cveValidForHours>
                    <failBuildOnCVSS>4</failBuildOnCVSS>
                </configuration>
                <executions>
                    <execution>
                        <goals>
                            <goal>check</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>
</project>
{% endhighlight %}

The configuration above will fail the Maven run if a dependency with a CVSS score above 4 is found and will recheck the NVD only every 12 hours. To run a standalone dependency check:

	mvn dependency-check:check

## Report Integration
Integrating a dependency check report into the generated Maven site is also quite easy thanks to the examples. Here's the relevant snippet of the [`pom.xml`](https://github.com/lanyonm/playground/blob/7bebfc970608c102b3d6be5951b24f9ba95459a9/pom.xml#L357):

{% highlight xml %}
<configuration>
    <reportPlugins>
        <plugin>
            <groupId>org.owasp</groupId>
            <artifactId>dependency-check-maven</artifactId>
            <version>1.3.3</version>
            <configuration>
                <name>Dependency Check</name>
            </configuration>
            <reportSets>
                <reportSet>
                    <reports>
                        <report>aggregate</report>
                    </reports>
                </reportSet>
            </reportSets>
        </plugin>
    </reportPlugins>
</configuration>
{% endhighlight %}

A "Dependency Check" link will be added to the Project Reports page of the generated site that points to a page that looks like this:

<div class="center">
  <figure>
    <a href="{{ site.url }}/images/dependency-check-report.png"><img src="{{ site.url }}/images/dependency-check-report.png" /></a>
    <figcaption>OWASP's Dependency Check showing CVE-2015-6420 in Apache's commons-collections:3.2.1</figcaption>
  </figure>
</div>

For illustrative purposes I included a known vulnerable dependency. Running `mvn site` didn't cause the build to fail because the plugin configuration used during the `site` lifecycle phase is separate from what was defined for the standalone check.

## Summary
While not a _full_ solution for security in your continuous delivery process, the dependency-check-maven plugin is a great way for a Java project to check the A9 box on the OWASP Top 10. Additionally, the visibility that the report gives dependency security is fantastic.

One handy feature I didn't mention is that a [suppression list](https://jeremylong.github.io/DependencyCheck/general/suppression.html) can be used to ignore positives. This can be used for false positives, or to ignore acknowledged vulnerabilities currently awaiting resolution in the backlog. This would allow the CI process to continue to run while the project is brought into compliance.
